# âœ… Prisma v6 + Next.js (SQLite) â€” Step-by-Step

> These steps **intentionally avoid Prisma 7** features like `prisma.config.ts`, adapters, or Accelerate.

---

## 0ï¸âƒ£ Create Fresh Next.js App

```bash
npx create-next-app@latest my-app --yes
cd my-app
npm run dev
```

Stop the dev server before continuing.

---

## 1ï¸âƒ£ Install **Prisma v6 (Pinned)**

This is **important** â€” otherwise npm will install v7.

```bash
npm install prisma@6 @prisma/client@6 --save-dev
```

Verify version:

```bash
npx prisma -v
```

You should see something like:

```
prisma 6.x.x
```

---

## 2ï¸âƒ£ Initialize Prisma

```bash
npx prisma init
```

This creates:

```
prisma/
 â””â”€â”€ schema.prisma
.env
```

---

## 3ï¸âƒ£ Configure SQLite (Prisma v6 Style)

### `.env`

```env
DATABASE_URL="file:./dev.db"
```

---

### `prisma/schema.prisma`

```prisma
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id        Int      @id @default(autoincrement())
  name      String
  email     String   @unique
  createdAt DateTime @default(now())
}
```

âœ”ï¸ This `url` field is **valid in Prisma v6**

---

## 4ï¸âƒ£ Run Migration (This Creates the DB)

```bash
npx prisma migrate dev --name init
```

This will:

* Create `prisma/dev.db`
* Generate migration SQL
* Generate Prisma Client

ğŸ“Œ If this step succeeds, Prisma is correctly installed.

---

## 5ï¸âƒ£ Create Prisma Client Singleton (Next.js-Safe)

ğŸ“ `src/lib/prisma.ts`

```ts
import { PrismaClient } from "@prisma/client";

const globalForPrisma = globalThis as unknown as {
  prisma: PrismaClient | undefined;
};

export const prisma =
  globalForPrisma.prisma ??
  new PrismaClient({
    log: ["query"],
  });

if (process.env.NODE_ENV !== "production") {
  globalForPrisma.prisma = prisma;
}
```

### Why this matters

* Prevents multiple DB connections during hot reload
* Recommended by Prisma for Next.js

---

## 6ï¸âƒ£ Use Prisma in App Router (Server Component)

ğŸ“ `src/app/page.tsx`

```ts
import { prisma } from "@/lib/prisma";

export default async function Home() {
  const users = await prisma.user.findMany();

  return (
    <main>
      <h1>Users</h1>
      <ul>
        {users.map((u) => (
          <li key={u.id}>
            {u.name} ({u.email})
          </li>
        ))}
      </ul>
    </main>
  );
}
```

âœ”ï¸ Works because App Router components are **server components by default**

---

## 7ï¸âƒ£ Insert Data via API Route (Optional but Recommended)

ğŸ“ `src/app/api/users/route.ts`

```ts
import { prisma } from "@/lib/prisma";
import { NextResponse } from "next/server";

export async function POST() {
  const user = await prisma.user.create({
    data: {
      name: "Alice",
      email: "alice@example.com",
    },
  });

  return NextResponse.json(user);
}
```

Test with:

```bash
POST http://localhost:3000/api/users
```

---

## 8ï¸âƒ£ Prisma Studio (Visual DB Viewer)

```bash
npx prisma studio
```

* Open browser UI
* Inspect `User` table
* Add / edit records visually

---

## ğŸ”´ Common Prisma v6 Errors & Fixes

### âŒ `@prisma/client did not initialize yet`

**Fix**

```bash
npx prisma generate
```

---

### âŒ DB file not created

**Cause:** migration not run
**Fix**

```bash
npx prisma migrate dev
```

---

### âŒ Prisma in client component

**Rule**

* âŒ `use client`
* âŒ React hooks
* âœ… Server Components / API routes

---

## ğŸ§  Prisma v6 Mental Model (Simple & Stable)

```
schema.prisma
 â”œâ”€ schema
 â”œâ”€ datasource (url)
 â””â”€ generator

Prisma CLI
 â”œâ”€ migrate
 â”œâ”€ generate
 â””â”€ studio

Next.js
 â””â”€ Prisma Client (singleton)
```

---

## ğŸ“Œ Final Recommendation

For **learning, tutorials, demos, and teaching**:

* âœ… **Prisma v6 is the right choice**
* âŒ Avoid Prisma v7 until ecosystem catches up

If you want, next we can:

* Add **relations** (`User` â†’ `Post`)
* Compare **Prisma v6 vs v7**
* Show **production deployment workflow**
* Add **Zod validation + Prisma**

Just tell me what youâ€™d like to do next ğŸ‘
